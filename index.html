<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="robots" content="index, follow">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="KAAP Commerce creates personalized, handcrafted resin keychains, jewelry, and gifts — perfect for birthdays, anniversaries, and special moments.">
  <meta name="keywords" content="gifts, resin keychains, personalized gifts, KAAP Commerce" />
  <meta name="author" content="KAAP Commerce Team" />
  <meta name="google-site-verification" content="oMOoPCP2rVTdlil-FA-hmLcm2ZgeMgjXBdIepu9C0Gg" />
  <title>KAAP Commerce | Handcrafted Resin Gifts, Jewelry & More</title>
  <link rel="icon" href="images/favicon.ico" type="image/x-icon" />
  <!-- Google Fonts for a modern look -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --pink: #ffd6ff;
      --lavender: #e7c6ff;
      --light-purple: #c8b6ff;
      --soft-blue: #b8c0ff;
      --pale-blue: #bbd0ff;
      --text-dark: #333;
      --highlight: #5e548e;
      --primary-gradient: linear-gradient(90deg, #c8b6ff 0%, #bbd0ff 100%);
      --shadow: 0 4px 16px rgba(94,84,142,0.12);
      --radius: 18px;
      --transition: 0.24s cubic-bezier(.4,0,.2,1);
      --cta: #ff6f61;
      --cta-gradient: linear-gradient(90deg, #ffb6b9 0%, #ff6f61 100%);
    }
    * { box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      margin: 0;
      font-family: 'Montserrat', 'Roboto', Arial, sans-serif;
      background: var(--pink);
      color: var(--text-dark);
      min-height: 100vh;
      overflow-x: hidden;
    }
    header {
      position: sticky;
      top: 0;
      background: var(--primary-gradient);
      padding: 12px 28px;
      z-index: 1000;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      border-bottom: 1.5px solid #e7c6ff;
      transition: background 0.4s;
    }
    .logo img { height: 54px; border-radius: 14px; }
    nav.nav-links {
      display: flex;
      align-items: center;
      gap: 18px;
      flex-wrap: wrap;
    }
    .nav-links a {
      text-decoration: none;
      color: var(--highlight);
      font-weight: 600;
      font-size: 1.08rem;
      padding: 5px 12px;
      border-radius: 8px;
      transition: background var(--transition), color var(--transition);
      position: relative;
    }
    .nav-links a:hover, .nav-links a:focus {
      color: #fff;
      background: var(--highlight);
      outline: none;
    }
    .nav-links #cartCount {
      font-weight: bold;
      color: var(--cta);
      font-size: 1.04rem;
      margin-left: 10px;
      background: #fff8;
      padding: 4px 12px;
      border-radius: 16px;
      transition: background var(--transition);
      cursor: pointer;
    }
    #landing-page {
      min-height: 88vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      background: #fff;
      border-radius: var(--radius);
      margin: 38px auto 0 auto;
      box-shadow: 0 8px 32px rgba(94,84,142,0.13);
      padding: 0;
      overflow: hidden;
      width: 97%;
      max-width: 1130px;
      animation: fadeIn 1.1s ease-in;
    }
    .hero-bg {
      position: absolute;
      inset: 0;
      z-index: 0;
      background: radial-gradient(circle at 70% 70%, #c8b6ff 0%, #ffd6ff 60%, #fff 100%);
      opacity: 0.85;
      pointer-events: none;
    }
    .hero-content {
      position: relative;
      z-index: 3;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      padding: 56px 36px 56px 66px;
      width: 100%;
      max-width: 600px;
    }
    .hero-title {
      font-size: 2.65rem;
      color: var(--highlight);
      font-weight: 800;
      margin: 12px 0 10px 0;
      line-height: 1.17;
      letter-spacing: 1.2px;
      background: linear-gradient(90deg, #5e548e 20%, #ff6f61 80%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .hero-subtitle {
      font-size: 1.22rem;
      color: #635985;
      margin-bottom: 32px;
      margin-top: 0;
      font-weight: 500;
      letter-spacing: .1px;
      max-width: 420px;
    }
    .shop-button {
      display: inline-block;
      margin-top: 7px;
      padding: 18px 42px;
      font-size: 1.1rem;
      background: var(--cta-gradient);
      color: #fff;
      border: none;
      border-radius: 25px;
      font-weight: 700;
      letter-spacing: .7px;
      box-shadow: 0 2px 8px #5e548e18;
      cursor: pointer;
      transition: background var(--transition), transform var(--transition);
      outline: none;
      animation: pulse 1.5s infinite;
      text-shadow: 0 2px 8px #5e548e13;
    }
    .shop-button:hover, .shop-button:focus {
      background: var(--highlight);
      transform: scale(1.08);
      outline: none;
      animation: none;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 #ff6f6140; }
      70% { box-shadow: 0 0 0 12px #ff6f6100; }
      100% { box-shadow: 0 0 0 0 #ff6f6100; }
    }
    section {
      padding: 54px 20px;
      animation: fadeIn 1.1s ease-in;
      margin-bottom: 0;
      position: relative;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px);}
      to { opacity: 1; transform: translateY(0);}
    }
    .section-title {
      font-size: 2rem;
      color: var(--highlight);
      margin-bottom: 9px;
      text-align: center;
      font-weight: 700;
      letter-spacing: .5px;
      position: relative;
      z-index: 3;
    }
    .byline {
      font-size: 1.04rem;
      color: #666;
      text-align: center;
      margin-top: -6px;
      margin-bottom: 22px;
      font-style: italic;
      letter-spacing: .2px;
    }
    section:not(:first-child):before {
      content: "";
      display: block;
      margin: 0 auto 32px auto;
      width: 58px;
      height: 4px;
      border-radius: 2px;
      background: var(--primary-gradient);
      opacity: .28;
    }
    .products-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 26px;
      margin-top: 18px;
      margin-bottom: 10px;
      justify-items: center;
    }
    .product-card {
      background: #fff;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      width: 100%;
      max-width: 320px;
      padding: 22px 16px 18px 16px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: transform var(--transition), box-shadow var(--transition);
      position: relative;
      overflow: hidden;
      min-height: 340px;
    }
    .product-card::before {
      content: "";
      position: absolute;
      top: -60px; left: -60px;
      width: 120px; height: 120px;
      background: var(--primary-gradient);
      border-radius: 50%;
      opacity: .10;
      z-index: 0;
      pointer-events: none;
    }
    .product-card:hover, .product-card:focus-within {
      transform: translateY(-8px) scale(1.025);
      box-shadow: 0 8px 24px rgba(94,84,142,0.16);
      outline: none;
    }
    .product-card h3 {
      font-size: 1.15rem;
      color: var(--highlight);
      margin: 10px 0 7px 0;
      font-weight: 700;
    }
    .product-card p { margin: 2px 0 14px 0; font-size: 1.01rem; line-height: 1.45;}
    .product-card button {
      padding: 11px 20px;
      background: #25D366;
      color: #fff;
      border: none;
      border-radius: 9px;
      font-weight: bold;
      cursor: pointer;
      font-size: 1rem;
      transition: background var(--transition), box-shadow var(--transition);
      box-shadow: 0 2px 6px #25d3661b;
      z-index: 1;
    }
    .product-card button:focus {
      outline: 2px solid var(--highlight);
      background: #1ebd56;
    }
    .product-card button:disabled {
      background: #ccc;
      color: #888;
      cursor: default;
      box-shadow: none;
    }
    .product-card.coming-soon {
      opacity: 0.7;
      filter: grayscale(0.16);
      pointer-events: none;
    }
    #buyNowBtn {
      display: none;
      margin: 28px auto 0 auto;
      background: var(--highlight);
      color: #fff;
      border: none;
      padding: 16px 36px;
      border-radius: 25px;
      font-size: 1.08rem;
      font-weight: 600;
      cursor: pointer;
      transition: background var(--transition), transform var(--transition);
      box-shadow: 0 2px 8px #5e548e25;
    }
    #buyNowBtn:hover, #buyNowBtn:focus {
      background: var(--cta);
      transform: scale(1.04);
      outline: none;
    }
    .loader {
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--highlight);
      border-radius: 50%;
      width: 44px;
      height: 44px;
      animation: spin 1s linear infinite;
      margin: 40px auto 28px auto;
      display: block;
    }
    @keyframes spin {
      0% { transform: rotate(0deg);}
      100% { transform: rotate(360deg);}
    }
    footer {
      text-align: center;
      background: var(--primary-gradient);
      color: #444;
      padding: 36px 0 24px 0;
      font-size: 1rem;
      margin-top: 44px;
      border-top: 1.5px solid #e7c6ff;
      letter-spacing: .2px;
      position: relative;
      z-index: 2;
    }
    #popupForm {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.6);
      z-index: 10000;
      justify-content: center;
      align-items: center;
      animation: fadeIn .32s;
    }
    #interestForm {
      background: #fff;
      padding: 26px 22px 20px 22px;
      border-radius: var(--radius);
      max-width: 370px;
      width: 95%;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 10px;
      animation: fadeIn .4s;
    }
    #interestForm h3 { text-align: center; margin-bottom: 10px; color: var(--highlight);}
    #interestForm input {
      width: 100%;
      margin-bottom: 6px;
      padding: 10px 8px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 1rem;
      font-family: inherit;
      background: #f8f8fd;
      transition: border var(--transition), box-shadow var(--transition);
    }
    #interestForm input:focus {
      outline: none;
      border: 1.5px solid var(--highlight);
      box-shadow: 0 0 6px #c8b6ff3a;
    }
    #interestForm button[type="submit"] {
      background: #25D366;
      color: #fff;
      border: none;
      padding: 13px;
      border-radius: 7px;
      font-weight: 600;
      font-size: 1.05rem;
      margin-top: 10px;
      cursor: pointer;
      transition: background var(--transition);
    }
    #interestForm button[type="submit"]:hover,
    #interestForm button[type="submit"]:focus {
      background: #1ebd56;
      outline: none;
    }
    #interestForm button#cancelBtn {
      background: #eee;
      color: #888;
      border: none;
      padding: 9px;
      border-radius: 7px;
      font-size: 1rem;
      cursor: pointer;
      transition: background var(--transition);
    }
    #interestForm button#cancelBtn:hover,
    #interestForm button#cancelBtn:focus {
      background: #ccc;
      color: #333;
      outline: none;
    }
    .product-image-slider {
      width: 100%;
      max-width: 230px;
      margin: 0 auto 10px auto;
      position: relative;
      overflow: hidden;
      border-radius: 13px;
      box-shadow: 0 2px 8px #b8c0ff28;
      background: #f8f8fd;
      min-height: 170px;
    }
    .slider-images-wrapper {
      display: flex;
      transition: transform 0.36s cubic-bezier(.4,0,.2,1);
      will-change: transform;
    }
    .slider-image-single {
      min-width: 230px;
      min-height: 170px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .slider-image-single img {
      width: 180px;
      height: 130px;
      object-fit: cover;
      border-radius: 13px;
      margin-top: 10px;
      margin-bottom: 7px;
      box-shadow: 0 2px 8px #b8c0ff28;
      background: #fff;
    }
    .slider-description {
      font-size: 0.96rem;
      color: #635985;
      text-align: center;
      margin-bottom: 8px;
      min-height: 32px;
      max-width: 200px;
      word-break: break-word;
    }
    .slider-nav-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: transparent !important;
      border: none;
      color: #5e548e;
      font-size: 1.7rem;
      border-radius: 50%;
      width: 38px;
      height: 38px;
      cursor: pointer;
      z-index: 3;
      transition: background 0.2s, color 0.2s;
      box-shadow: none;
      outline: none;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: .92;
    }
    .slider-nav-btn:hover, .slider-nav-btn:focus {
      background: #e7c6ff50 !important;
      color: #ff6f61;
    }
    .slider-prev { left: 4px; }
    .slider-next { right: 4px; }
    .slider-dots {
      display: flex;
      justify-content: center;
      margin-bottom: 2px;
      gap: 5px;
    }
    .slider-dot {
      width: 8px;
      height: 8px;
      background: #c8b6ff;
      border-radius: 50%;
      opacity: 0.4;
      cursor: pointer;
      transition: opacity 0.2s;
      border: none;
      padding: 0;
    }
    .slider-dot.active {
      background: #5e548e;
      opacity: 1;
    }
    @media (max-width: 1200px) {
      #landing-page { max-width: 99vw; }
      .hero-content { padding: 46px 12px 46px 22px; }
    }
    @media (max-width: 900px) {
      section { padding: 34px 12px;}
      .products-container { gap: 18px;}
      .product-card { min-height: 320px;}
      .hero-content { padding: 36px 12px 36px 12px; }
      .hero-title { font-size: 2.1rem; }
    }
    @media (max-width: 700px) {
      #landing-page {
        flex-direction: column;
        padding: 0;
        margin-top: 14px;
      }
      .hero-content {
        align-items: center;
        padding: 30px 10px 24px 10px;
        max-width: unset;
        width: 100%;
      }
    }
    @media (max-width: 600px) {
      header { flex-direction: column; align-items: flex-start; padding: 10px 8px;}
      .logo img { height: 44px;}
      nav.nav-links { width: 100%; gap: 10px; justify-content: flex-start;}
      #landing-page { padding: 0; }
      .products-container { grid-template-columns: 1fr; }
      .product-card { padding: 16px 7px 14px 7px; }
      #interestForm { padding: 16px 7px 14px 7px; }
      .hero-title { font-size: 1.24rem; }
    }
    #cartBuyNowBtn {
      background: var(--highlight);
      color: #fff;
      border: none;
      padding: 13px 30px;
      border-radius: 20px;
      font-size: 1.08rem;
      font-weight: 600;
      cursor: pointer;
      transition: background var(--transition), transform var(--transition);
      box-shadow: 0 2px 8px #5e548e25;
      margin: 18px auto 0 auto;
      display: block;
    }
    #cartBuyNowBtn:hover, #cartBuyNowBtn:focus {
      background: var(--cta);
      transform: scale(1.04);
      outline: none;
    }
    .cart-total-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      font-weight: bold;
      color: var(--highlight);
      font-size: 1.08rem;
      border-top: 1px solid #eee;
      padding-top: 8px;
    }
  </style>
</head>
<body>
<header>
  <div class="logo"><img src="images/kaap-logo.jpg" alt="KAAP Commerce Logo" /></div>
  <nav class="nav-links" aria-label="Main navigation">
    <a href="#landing-page">Home</a>
    <a href="#products">Products</a>
    <a href="#upcoming">Upcoming</a>
    <a href="#about">About</a>
    <a href="#vision">Vision</a>
    <span id="cartCount" aria-label="Shopping cart" tabindex="0" style="cursor:pointer;">🛒 (0)</span>
  </nav>
</header>

<!-- Cart Popup -->
<div id="cartPopup" style="display:none; position:fixed; top:70px; right:20px; background:#fff; border-radius:14px; box-shadow:0 8px 32px rgba(94,84,142,0.13); z-index:2000; min-width:260px; max-width:98vw; padding:18px 12px 14px 12px;">
  <h3 style="margin-top:0; color:#5e548e; font-size:1.1rem; text-align:center;">Your Cart</h3>
  <div id="cartItemsList"></div>
  <div id="cartTotalRow"></div>
  <button id="cartBuyNowBtn" style="display:none;">Buy Now</button>
  <button id="closeCartPopup" style="margin:12px auto 0 auto; display:block; background:#eee; color:#555; border:none; border-radius:8px; padding:6px 18px; cursor:pointer;">Close</button>
</div>

<main>
<section id="landing-page">
  <div class="hero-bg"></div>
  <div class="hero-content">
    <h1 class="hero-title">
      Surprise &amp; Delight<br>
      <span style="font-weight:900;">with Gifts for Loved Ones</span>
    </h1>
    <p class="hero-subtitle">Thoughtful, personalized creations for every occasion.<br>
      <b>KAAP Commerce</b> helps you make every moment extra special.
    </p>
    <a href="#products" class="shop-button" aria-label="Shop Now">Shop Now</a>
  </div>
</section>

<section id="products">
  <h2 class="section-title">Featured Products</h2>
  <p class="byline">Curated by KAAP Commerce</p>
  <div class="products-container" id="productList">
    <span class="loader" id="productLoader"></span>
  </div>
</section>

<section id="upcoming">
  <h2 class="section-title">Future Upcoming</h2>
  <p class="byline">Jewellery by Pravallika</p>
  <div class="products-container">
    <div class="product-card coming-soon" tabindex="0" aria-label="Upcoming Jewellery Collection">
      <img src="images/coming-soon.jpg" alt="Upcoming Jewellery Collection" />
      <h3>Coming Soon</h3>
      <p>Elegant jewellery launching soon!</p>
    </div>
  </div>
</section>

<section id="about">
  <h2 class="section-title">About Us</h2>
  <p style="text-align:center; max-width:600px; margin:0 auto;">
    KAAP Commerce is a young, passionate brand providing unique gifts for all occasions.
  </p>
</section>

<section id="vision">
  <h2 class="section-title">Our Vision &amp; Motto</h2>
  <p style="text-align:center; max-width:600px; margin:0 auto;">
    Our vision is to empower creativity and bring smiles through meaningful gifts.<br>
    <strong>Motto:</strong> “Create. Celebrate. Cherish.”
  </p>
</section>
</main>

<footer>
  &copy; 2025 KAAP Commerce. All rights reserved.
</footer>

<!-- Popup Form -->
<div id="popupForm" aria-modal="true" role="dialog">
  <form id="interestForm" autocomplete="on">
    <h3>Your Details</h3>
    <input type="text" id="custName" placeholder="Your Name" required aria-label="Your Name" />
    <input type="text" id="custAddress" placeholder="Your Address" required aria-label="Your Address" />
    <input type="email" id="custEmail" placeholder="Your Email" required aria-label="Your Email" />
    <input type="tel" id="custPhone" placeholder="WhatsApp Number" required aria-label="WhatsApp Number" />
    <input type="text" id="custPin" placeholder="PIN Code (6 digits)" pattern="\d{6}" maxlength="6" required aria-label="PIN Code" />
    <button type="submit">Submit &amp; Go to WhatsApp</button>
    <button type="button" id="cancelBtn">Cancel</button>
  </form>
</div>

<script>
(() => {
  const container = document.getElementById("productList");
  const loader = document.getElementById("productLoader");
  const cartCount = document.getElementById("cartCount");
  const popupForm = document.getElementById("popupForm");
  const cancelBtn = document.getElementById("cancelBtn");
  const interestForm = document.getElementById("interestForm");
  const cartPopup = document.getElementById("cartPopup");
  const cartItemsList = document.getElementById("cartItemsList");
  const closeCartPopup = document.getElementById("closeCartPopup");
  const cartBuyNowBtn = document.getElementById("cartBuyNowBtn");
  const cartTotalRow = document.getElementById("cartTotalRow");

  let cart = [];
  let cartForBuyNow = null;
const GOOGLE_SHEET_API_URL = "https://script.google.com/macros/s/AKfycbyR6Xrd93DwH3xgE4g4nq3WERPBWgdHh3vwgQItEY_jPvn-MoVStNI8EGxJfeoRFGzi5w/exec";
  function parseToArray(val) {
    if (!val) return [];
    if (typeof val === "string") {
      try { return JSON.parse(val); }
      catch { return val.split(",").map(s => s.trim()).filter(Boolean); }
    }
    return Array.isArray(val) ? val : [val];
  }

  popupForm.style.display = "none";

  function findCartIndex(id) {
    return cart.findIndex(item => item.id === id);
  }

  function updateCartCount() {
    const total = cart.reduce((sum, item) => sum + item.qty, 0);
    cartCount.innerText = `🛒 (${total})`;
  }

  function renderCartPopup() {
    if (cart.length === 0) {
      cartItemsList.innerHTML = "<p style='text-align:center; color:#888; margin:14px 0;'>Your cart is empty.</p>";
      cartBuyNowBtn.style.display = "none";
      cartTotalRow.innerHTML = "";
    } else {
      cartItemsList.innerHTML = cart.map((item, idx) => `
        <div style="border-bottom:1px solid #eee; padding:8px 0; display:flex; justify-content:space-between; align-items:center; gap:5px;">
          <span style="max-width:120px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">${item.name}</span>
          <div style="display:flex;align-items:center;gap:2px;">
            <button class="cartMinusBtn" data-idx="${idx}" aria-label="Decrease quantity" style="font-size:1rem;padding:2px 7px;">-</button>
            <span style="margin:0 7px; min-width:18px; display:inline-block; text-align:center;">${item.qty}</span>
            <button class="cartPlusBtn" data-idx="${idx}" aria-label="Increase quantity" style="font-size:1rem;padding:2px 7px;">+</button>
          </div>
          <span style="color:#5e548e; font-weight:500; margin-left:7px;">${item.price}</span>
          <button class="cartRemoveBtn" data-idx="${idx}" aria-label="Remove from cart" style="background:none;border:none;color:#e55b51;font-size:1.2rem;cursor:pointer;">&#10005;</button>
        </div>
      `).join("");
      let total = cart.reduce((sum, item) => {
        let priceNum = 0;
        if (typeof item.price === "number") priceNum = item.price;
        else {
          let match = (""+item.price).replace(/,/g,"").match(/(\d+(\.\d+)?)/);
          priceNum = match ? parseFloat(match[1]) : 0;
        }
        return sum + (priceNum * item.qty);
      }, 0);
      cartTotalRow.innerHTML = `<div class="cart-total-row"><span>Total:</span><span>₹${total.toFixed(2)}</span></div>`;
      cartBuyNowBtn.style.display = "block";
      setTimeout(() => {
        cartItemsList.querySelectorAll('.cartRemoveBtn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const idx = Number(btn.getAttribute('data-idx'));
            cart.splice(idx, 1);
            updateCartCount();
            renderCartPopup();
          });
        });
        cartItemsList.querySelectorAll('.cartPlusBtn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const idx = Number(btn.getAttribute('data-idx'));
            cart[idx].qty += 1;
            updateCartCount();
            renderCartPopup();
          });
        });
        cartItemsList.querySelectorAll('.cartMinusBtn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const idx = Number(btn.getAttribute('data-idx'));
            if (cart[idx].qty > 1) {
              cart[idx].qty -= 1;
            } else {
              cart.splice(idx, 1);
            }
            updateCartCount();
            renderCartPopup();
          });
        });
      }, 0);
    }
    cartPopup.style.display = "block";
  }

  cartCount.addEventListener("click", (e) => {
    renderCartPopup();
  });
  cartCount.addEventListener("keydown", (e) => {
    if (e.key === "Enter" || e.key === " " || e.keyCode === 13) {
      renderCartPopup();
    }
  });

  closeCartPopup.addEventListener("click", () => {
    cartPopup.style.display = "none";
  });

  window.addEventListener("mousedown", (e) => {
    if (cartPopup.style.display === "block" && !cartPopup.contains(e.target) && e.target !== cartCount) {
      cartPopup.style.display = "none";
    }
  });

  cartBuyNowBtn.onclick = () => {
    if (cart.length === 0) return;
    cartPopup.style.display = "none";
    popupForm.style.display = "flex";
    setTimeout(() => interestForm.querySelector("input").focus(), 180);
  };

  fetch(GOOGLE_SHEET_API_URL)
    .then(res => res.json())
    .then(products => {
      loader && loader.remove();
      if (!products.length) {
        container.innerHTML = "<p style='color:#e55b51'>No products available at the moment.</p>";
        return;
      }
      products.forEach((p, i) => {
        const images = parseToArray(p.images || p.image);
        const descriptions = parseToArray(p.descriptions || p.description);

        const card = document.createElement("div");
        card.className = "product-card";
        card.tabIndex = 0;
        const hasMultiple = images.length > 1;
        let sliderImagesHtml = '';
        for (let j = 0; j < images.length; j++) {
          sliderImagesHtml += `
            <div class="slider-image-single">
              <img src="${images[j]}" alt="${p.name} ${descriptions[j] ? '- '+descriptions[j] : ''}" />
              <div class="slider-description">${descriptions[j] || ''}</div>
            </div>
          `;
        }
        const sliderId = `slider-${i}-${Date.now()}`;
        card.innerHTML = `
          <div class="product-image-slider" id="${sliderId}">
            ${hasMultiple ? `<button class="slider-nav-btn slider-prev" style="display:none" aria-label="Previous image">&#8592;</button>` : ''}
            <div class="slider-images-wrapper">
              ${sliderImagesHtml}
            </div>
            ${hasMultiple ? `<button class="slider-nav-btn slider-next" aria-label="Next image">&#8594;</button>` : ''}
            <div class="slider-dots"${hasMultiple ? '' : ' style="display:none;"'}>
              ${images.map((_,idx)=>
                `<button class="slider-dot${idx===0?' active':''}" data-idx="${idx}" aria-label="Go to image ${idx+1}"></button>`).join('')}
            </div>
          </div>
          <h3>${p.name}</h3>
          <p>Price: <b>${p.price}</b></p>
          <div style="margin-bottom: 12px;">
            <button type="button" class="minusQty" aria-label="Decrease quantity" style="font-size:1.2rem;padding:2px 10px;">-</button>
            <span class="qtyDisplay" style="margin: 0 10px; font-size:1.1rem;">1</span>
            <button type="button" class="plusQty" aria-label="Increase quantity" style="font-size:1.2rem;padding:2px 10px;">+</button>
          </div>
          <button type="button" class="addToCartBtn" aria-label="Add ${p.name} to cart">Add to Cart</button>
        `;

        setTimeout(() => {
          const slider = card.querySelector(`#${sliderId}`);
          if (!slider) return;
          const wrapper = slider.querySelector('.slider-images-wrapper');
          const prevBtn = slider.querySelector('.slider-prev');
          const nextBtn = slider.querySelector('.slider-next');
          const dots = Array.from(slider.querySelectorAll('.slider-dot'));
          let idx = 0;
          function show(idxToShow) {
            idx = idxToShow;
            wrapper.style.transform = `translateX(-${230*idx}px)`;
            dots.forEach((d,di)=>d.classList.toggle('active', di===idx));
            if (prevBtn) prevBtn.style.display = idx === 0 ? 'none':'flex';
            if (nextBtn) nextBtn.style.display = idx === images.length-1 ? 'none':'flex';
          }
          if (hasMultiple) {
            prevBtn && prevBtn.addEventListener('click', ()=> show(Math.max(idx-1,0)));
            nextBtn && nextBtn.addEventListener('click', ()=> show(Math.min(idx+1,images.length-1)));
            dots.forEach((d,di)=>d.addEventListener('click', ()=>show(di)));
          }
        }, 0);

        let qty = 1;
        const minusBtn = card.querySelector('.minusQty');
        const plusBtn = card.querySelector('.plusQty');
        const qtyDisplay = card.querySelector('.qtyDisplay');
        minusBtn.addEventListener('click', ()=>{
          if(qty > 1) qty--;
          qtyDisplay.textContent = qty;
        });
        plusBtn.addEventListener('click', ()=>{
          qty++;
          qtyDisplay.textContent = qty;
        });

        const addToCartBtn = card.querySelector('.addToCartBtn');
        addToCartBtn.addEventListener("click", () => {
          const idx = findCartIndex(p.id);
          if (idx !== -1) {
            cart[idx].qty += qty;
          } else {
            cart.push({ id: p.id, name: p.name, price: p.price, image: images[0], qty });
          }
          updateCartCount();
          addToCartBtn.innerText = "Added!";
          addToCartBtn.disabled = true;
          setTimeout(()=>{
            addToCartBtn.innerText = "Add to Cart";
            addToCartBtn.disabled = false;
          }, 1200);
          qty = 1;
          qtyDisplay.textContent = qty;
        });

        container.appendChild(card);
      });
    })
    .catch(err => {
      loader && loader.remove();
      container.innerHTML = "<p style='color:#e55b51'>Failed to load products. Please try again later.</p>";
      console.error("Error fetching products:", err);
    });

  cancelBtn.onclick = () => {
    popupForm.style.display = "none";
  };

  interestForm.onsubmit = async (e) => {
    e.preventDefault();
    const name = document.getElementById("custName").value.trim();
    const address = document.getElementById("custAddress").value.trim();
    const email = document.getElementById("custEmail").value.trim();
    const phone = document.getElementById("custPhone").value.trim();
    const pin = document.getElementById("custPin").value.trim();

    if (!/^\d{6}$/.test(pin)) {
      alert("Please enter a valid 6-digit PIN code.");
      return;
    }
    if (!address) {
      alert("Please enter your address.");
      return;
    }

    let total = cart.reduce((sum, item) => {
      let priceNum = 0;
      if (typeof item.price === "number") priceNum = item.price;
      else {
        let match = (""+item.price).replace(/,/g,"").match(/(\d+(\.\d+)?)/);
        priceNum = match ? parseFloat(match[1]) : 0;
      }
      return sum + (priceNum * item.qty);
    }, 0);

    // Flatten cart data for Google Sheets
    const productNames = cart.map(p => p.name).join(', ');
    const productIds = cart.map(p => p.id).join(', ');
    const productQtys = cart.map(p => p.qty).join(', ');
    const productPrices = cart.map(p => (typeof p.price === "number" ? p.price : ((""+p.price).replace(/,/g,"").match(/(\d+(\.\d+)?)/)?.[1] || ""))).join(', ');

    const productLines = cart.map((p, i) => {
      let priceText = typeof p.price === "number" ? `₹${p.price}` : p.price;
      return `Product ${i+1}:\n🆔 ID: ${p.id}\n📦 Name: ${p.name}\n💰 Price: ${priceText}\nQty: ${p.qty}`;
    }).join('%0A%0A');

    // WhatsApp message: only products and total, not user details
    const url = `https://wa.me/918977659800?text=Hello! I'm interested in these items:%0A%0A${productLines}%0A%0A🧾 Total: ₹${total.toFixed(2)}`;

    // Send a single POST request with all user details and the entire cart array, FLATTENED for Google Sheets
    await fetch("https://script.google.com/macros/s/AKfycbwTNnPO7YkA-QdA4uQBTAMsDgW0crnFGnK1L0xuyaPn2axoyV1O3gXkjPitXmJ4Z89_9A/exec", {
      method: "POST",
      mode: "no-cors",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        name,
        address,
        email,
        phone,
        pin,
        productNames,
        productIds,
        productQtys,
        productPrices,
        total: total.toFixed(2),
        // For reference, include the full cart JSON (optional)
        cart: JSON.stringify(cart)
      })
    });

    window.location.href = url;

    popupForm.style.display = "none";
    interestForm.reset();
    cart = [];
    updateCartCount();
  };

  window.addEventListener("keydown", (e) => {
    if (popupForm.style.display === "flex" && e.key === "Escape") {
      popupForm.style.display = "none";
    }
    if (cartPopup.style.display === "block" && e.key === "Escape") {
      cartPopup.style.display = "none";
    }
  });
})();
</script>
</body>
</html>
